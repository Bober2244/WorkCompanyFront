{"ast":null,"code":"import store from '@/store';\nimport ModalWindow from \"@/components/ModalWindow.vue\";\nimport axios from \"axios\"; // импортируем axios\n\nexport default {\n  components: {\n    ModalWindow\n  },\n  props: {\n    isOpen: {\n      type: Boolean,\n      required: true\n    }\n  },\n  data() {\n    return {\n      itemIdToRemove: null,\n      itemSizeToRemove: null\n    };\n  },\n  emits: [\"close\"],\n  async mounted() {\n    await store.loadCart(); // Загружаем корзину при монтировании компонента\n  },\n\n  computed: {\n    cartItems() {\n      return store.cartItems; // Получаем список товаров из store\n    },\n\n    totalPrice() {\n      return store.totalPrice; // Считаем общую цену через store\n    },\n\n    totalItems() {\n      return store.totalItems; // Получаем общее количество товаров из store\n    }\n  },\n\n  methods: {\n    closeCart() {\n      this.$emit(\"close\");\n    },\n    showModal(itemId, size) {\n      this.itemIdToRemove = itemId;\n      this.itemSizeToRemove = size;\n      this.$refs.confirmationModal.openModal();\n    },\n    async removeItem() {\n      try {\n        const userId = sessionStorage.getItem(\"userId\");\n        const itemId = this.itemIdToRemove;\n        const size = this.itemSizeToRemove;\n        if (!userId) {\n          console.error(\"User is not authenticated\");\n          return;\n        }\n        const url = `http://localhost:8000/api/carts?user_id=${userId}&item_id=${itemId}&size=${size}`;\n        const response = await axios.delete(url);\n        if (response.status === 200) {\n          this.$emit(\"item-removed\", itemId);\n          window.location.reload();\n        } else {\n          console.error(\"Error removing item from cart:\", response.data.message);\n        }\n      } catch (error) {\n        console.error(\"Error removing item from cart:\", error);\n      }\n    },\n    async increaseQuantity(item) {\n      const userId = sessionStorage.getItem(\"userId\");\n      if (!userId) {\n        console.error(\"User is not authenticated\");\n        return;\n      }\n      try {\n        const url = `http://localhost:8000/api/carts/increase?user_id=${userId}&item_id=${item.item_id}&size=${item.size}`;\n        const response = await axios.post(url);\n        if (response.status === 200) {\n          this.$emit(\"quantity-changed\", item.item_id); // Обновляем отображение\n          store.loadCart(); // Загружаем обновленную корзину\n        }\n      } catch (error) {\n        console.error(\"Error increasing item quantity:\", error);\n      }\n    },\n    async decreaseQuantity(item) {\n      const userId = sessionStorage.getItem(\"userId\");\n      if (!userId) {\n        console.error(\"User is not authenticated\");\n        return;\n      }\n      try {\n        const url = `http://localhost:8000/api/carts/decrease?user_id=${userId}&item_id=${item.item_id}&size=${item.size}`;\n        const response = await axios.post(url);\n        if (response.status === 200) {\n          this.$emit(\"quantity-changed\", item.item_id); // Обновляем отображение\n          store.loadCart(); // Загружаем обновленную корзину\n        }\n      } catch (error) {\n        console.error(\"Error decreasing item quantity:\", error);\n      }\n    },\n    async goToPayment() {\n      const userId = sessionStorage.getItem(\"userId\");\n      try {\n        const paymentResponse = await axios.post(\"http://localhost:8000/api/payments\", {\n          amount: String(this.totalPrice),\n          description: \"Payment for cart items\"\n        });\n        const confirmationUrl = paymentResponse.data.confirmation_url;\n        if (confirmationUrl) {\n          await axios.delete(`http://localhost:8000/api/carts/all?user_id=${userId}`);\n          window.location.href = confirmationUrl;\n        } else {\n          console.error(\"No confirmation URL received\");\n        }\n      } catch (error) {\n        console.error(\"Error initiating payment:\", error);\n      }\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["store","ModalWindow","axios","components","props","isOpen","type","Boolean","required","data","itemIdToRemove","itemSizeToRemove","emits","mounted","loadCart","computed","cartItems","totalPrice","totalItems","methods","closeCart","$emit","showModal","itemId","size","$refs","confirmationModal","openModal","removeItem","userId","sessionStorage","getItem","console","error","url","response","delete","status","window","location","reload","message","increaseQuantity","item","item_id","post","decreaseQuantity","goToPayment","paymentResponse","amount","String","description","confirmationUrl","confirmation_url","href"],"sourceRoot":"","sources":["/Users/nicolassergeev/WebstormProjects/frontend-ShoesShop/src/components/CartShop.vue"],"sourcesContent":["<template>\n  <div :class=\"['cart-panel', { open: isOpen }]\" @click.self=\"closeCart\">\n    <div class=\"cart-content\">\n      <div class=\"cart-header\">\n        <h3>Корзина ({{ totalItems }} шт.)</h3>\n        <img src=\"../../public/emoji-2.png\" alt=\"Корзина\" class=\"cart-icon\" />\n        <button @click=\"closeCart\" class=\"close-button\">\n          <img src=\"../../public/close.svg\" alt=\"Close\" width=\"24\" height=\"24\" />\n        </button>\n      </div>\n      <div v-if=\"cartItems.length\" class=\"cart-items\">\n        <div v-for=\"item in cartItems\" :key=\"item.id\" class=\"cart-item\">\n          <router-link :to=\"{ name: 'ProductDetail', params: { id: item.item_id } }\" class=\"item-title-link\">\n            <h6>{{ item.title }}</h6>\n            <h6 class=\"item-size\">Размер: {{ item.size }}</h6>\n          </router-link>\n          <p class=\"item-price\">{{ item.price }} руб.</p>\n\n          <!-- Кнопки для изменения количества товара -->\n          <div class=\"quantity-controls\">\n            <button @click=\"decreaseQuantity(item)\" :disabled=\"item.quantity <= 1\">-</button>\n            <span>{{ item.quantity }}</span>\n            <button @click=\"increaseQuantity(item)\">+</button>\n          </div>\n\n          <button @click=\"showModal(item.item_id, item.size)\" class=\"remove-button\">X</button>\n        </div>\n        <div class=\"cart-footer\">\n          <h3>Итого: {{ totalPrice }} руб.</h3>\n          <button @click=\"goToPayment\" class=\"form__button\">Перейти к оплате</button>\n        </div>\n      </div>\n      <div v-else>\n        <p>Ваша корзина пуста</p>\n        <img src=\"../../public/emoji-1.png\" alt=\"Корзина\" class=\"cart-icon\" />\n      </div>\n    </div>\n  </div>\n\n  <ModalWindow\n      :title=\"'Убрать из корзины?'\"\n      :message=\"'Вы уверены, что хотите удалить из корзины данный товар?'\"\n      ref=\"confirmationModal\"\n      @confirm=\"removeItem\"\n  />\n</template>\n\n<script>\nimport store from '@/store';\nimport ModalWindow from \"@/components/ModalWindow.vue\";\nimport axios from \"axios\"; // импортируем axios\n\nexport default {\n  components: { ModalWindow },\n  props: {\n    isOpen: {\n      type: Boolean,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      itemIdToRemove: null,\n      itemSizeToRemove: null,\n    };\n  },\n  emits: [\"close\"],\n  async mounted() {\n    await store.loadCart(); // Загружаем корзину при монтировании компонента\n  },\n  computed: {\n    cartItems() {\n      return store.cartItems; // Получаем список товаров из store\n    },\n    totalPrice() {\n      return store.totalPrice; // Считаем общую цену через store\n    },\n    totalItems() {\n      return store.totalItems; // Получаем общее количество товаров из store\n    },\n  },\n  methods: {\n    closeCart() {\n      this.$emit(\"close\");\n    },\n    showModal(itemId, size) {\n      this.itemIdToRemove = itemId;\n      this.itemSizeToRemove = size;\n      this.$refs.confirmationModal.openModal();\n    },\n    async removeItem() {\n      try {\n        const userId = sessionStorage.getItem(\"userId\");\n        const itemId = this.itemIdToRemove;\n        const size = this.itemSizeToRemove;\n\n        if (!userId) {\n          console.error(\"User is not authenticated\");\n          return;\n        }\n\n        const url = `http://localhost:8000/api/carts?user_id=${userId}&item_id=${itemId}&size=${size}`;\n        const response = await axios.delete(url);\n\n        if (response.status === 200) {\n          this.$emit(\"item-removed\", itemId);\n          window.location.reload();\n        } else {\n          console.error(\"Error removing item from cart:\", response.data.message);\n        }\n      } catch (error) {\n        console.error(\"Error removing item from cart:\", error);\n      }\n    },\n    async increaseQuantity(item) {\n      const userId = sessionStorage.getItem(\"userId\");\n      if (!userId) {\n        console.error(\"User is not authenticated\");\n        return;\n      }\n\n      try {\n        const url = `http://localhost:8000/api/carts/increase?user_id=${userId}&item_id=${item.item_id}&size=${item.size}`;\n        const response = await axios.post(url);\n\n        if (response.status === 200) {\n          this.$emit(\"quantity-changed\", item.item_id); // Обновляем отображение\n          store.loadCart(); // Загружаем обновленную корзину\n        }\n      } catch (error) {\n        console.error(\"Error increasing item quantity:\", error);\n      }\n    },\n    async decreaseQuantity(item) {\n      const userId = sessionStorage.getItem(\"userId\");\n      if (!userId) {\n        console.error(\"User is not authenticated\");\n        return;\n      }\n\n      try {\n        const url = `http://localhost:8000/api/carts/decrease?user_id=${userId}&item_id=${item.item_id}&size=${item.size}`;\n        const response = await axios.post(url);\n\n        if (response.status === 200) {\n          this.$emit(\"quantity-changed\", item.item_id); // Обновляем отображение\n          store.loadCart(); // Загружаем обновленную корзину\n        }\n      } catch (error) {\n        console.error(\"Error decreasing item quantity:\", error);\n      }\n    },\n    async goToPayment() {\n      const userId = sessionStorage.getItem(\"userId\");\n      try {\n        const paymentResponse = await axios.post(\"http://localhost:8000/api/payments\", {\n          amount: String(this.totalPrice),\n          description: \"Payment for cart items\",\n        });\n\n        const confirmationUrl = paymentResponse.data.confirmation_url;\n\n        if (confirmationUrl) {\n          await axios.delete(`http://localhost:8000/api/carts/all?user_id=${userId}`);\n          window.location.href = confirmationUrl;\n        } else {\n          console.error(\"No confirmation URL received\");\n        }\n      } catch (error) {\n        console.error(\"Error initiating payment:\", error);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n.quantity-controls {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.quantity-controls button {\n  background-color: #4caf50;\n  color: white;\n  padding: 5px 10px;\n  font-size: 18px;\n  border: none;\n  cursor: pointer;\n  border-radius: 5px;\n  transition: background-color 0.2s ease;\n}\n\n.quantity-controls button:disabled {\n  background-color: #ddd;\n  cursor: not-allowed;\n}\n\n.quantity-controls span {\n  font-size: 16px;\n  font-weight: bold;\n}\n\n.remove-button {\n  padding: 4px 8px;\n  background-color: transparent;\n  color: #f44336;\n  border: none;\n  cursor: pointer;\n  font-size: 18px;\n  font-weight: bold;\n  transition: color 0.2s;\n}\n\n.remove-button:hover {\n  color: #d32f2f;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}