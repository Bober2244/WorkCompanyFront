{"ast":null,"code":"import AppHeader from \"@/components/AppHeader.vue\";\nimport AppFooter from \"@/components/AppFooter.vue\";\nimport axios from \"axios\";\nimport VueSelect from \"@/components/VueSelect.vue\";\nexport default {\n  name: \"ProductReviews\",\n  components: {\n    VueSelect,\n    AppFooter,\n    AppHeader\n  },\n  data() {\n    return {\n      products: [],\n      reviews: [],\n      feedback: {\n        name: '',\n        message: '',\n        rating: 0,\n        agree: false,\n        category: 'product'\n      },\n      selectedProductId: null\n    };\n  },\n  computed: {\n    isFormValid() {\n      return this.feedback.name && this.feedback.message && this.feedback.rating > 0 && this.feedback.category && this.feedback.agree && (this.feedback.category !== \"product\" || this.selectedProductId);\n    },\n    productsWithLabels() {\n      return this.products.map(product => ({\n        label: product.title,\n        value: product.id\n      }));\n    }\n  },\n  methods: {\n    getProductImage(itemId) {\n      const product = this.products.find(product => product.id === itemId);\n      return product && product.image_urls.length > 0 ? product.image_urls[0] : 'default-image.jpg';\n    },\n    getProductTitle(itemId) {\n      const product = this.products.find(product => product.id === itemId);\n      return product ? product.title : 'Неизвестный продукт';\n    },\n    updateSelectedProductId(productId) {\n      console.log(\"Received productId in parent:\", productId); // Лог для проверки\n      this.selectedProductId = productId;\n    },\n    async fetchReviews() {\n      try {\n        const response = await axios.get(\"http://localhost:8000/api/reviews\");\n        this.reviews = response.data;\n      } catch (error) {\n        console.error(\"Ошибка при загрузке отзывов:\", error);\n      }\n    },\n    async fetchProducts() {\n      try {\n        const response = await axios.get(\"http://localhost:8000/api/items\");\n        this.products = response.data;\n        console.log(this.products);\n      } catch (error) {\n        console.error(\"Ошибка при загрузке отзывов:\", error);\n      }\n    },\n    async submitFeedback() {\n      try {\n        const userId = sessionStorage.getItem('userId');\n        const toNow = new Date().toISOString();\n        console.log({\n          name_of_reviewer: this.feedback.name,\n          text: this.feedback.message,\n          score: this.feedback.rating,\n          category: this.feedback.category,\n          date: toNow,\n          user_id: parseInt(userId),\n          item_id: this.selectedProductId\n        });\n        await axios.post('http://localhost:8000/api/reviews', {\n          name_of_reviewer: this.feedback.name,\n          text: this.feedback.message,\n          score: this.feedback.rating,\n          category: this.feedback.category,\n          date: toNow,\n          user_id: parseInt(userId),\n          item_id: this.selectedProductId\n        });\n        await this.fetchReviews();\n        this.feedback = {\n          name: '',\n          message: '',\n          rating: 0,\n          agree: false,\n          category: 'product'\n        };\n      } catch (error) {\n        console.error(\"Ошибка при загрузке данных отзыва:\", error.response ? error.response.data : error);\n        alert(\"Не удалось отправить отзыв. Попробуйте позже.\");\n      }\n    },\n    formatDate(dateString) {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('ru-RU', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric'\n      });\n    },\n    setRating(rating) {\n      this.feedback.rating = rating;\n    }\n  },\n  mounted() {\n    this.fetchReviews();\n    this.fetchProducts();\n  }\n};","map":{"version":3,"mappings":"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","names":["AppHeader","AppFooter","axios","VueSelect","name","components","data","products","reviews","feedback","message","rating","agree","category","selectedProductId","computed","isFormValid","productsWithLabels","map","product","label","title","value","id","methods","getProductImage","itemId","find","image_urls","length","getProductTitle","updateSelectedProductId","productId","console","log","fetchReviews","response","get","error","fetchProducts","submitFeedback","userId","sessionStorage","getItem","toNow","Date","toISOString","name_of_reviewer","text","score","date","user_id","parseInt","item_id","post","alert","formatDate","dateString","toLocaleDateString","day","month","year","setRating","mounted"],"sourceRoot":"","sources":["/Users/nicolassergeev/WebstormProjects/frontend-ShoesShop/pages/Reviews.vue"],"sourcesContent":["<template>\n  <AppHeader></AppHeader>\n  <div class=\"reviews-page\">\n    <h1>Отзывы о нас</h1>\n\n    <div class=\"reviews-list\">\n      <div class=\"review-item\" v-for=\"review in reviews\" :key=\"review.id\">\n        <div v-if=\"review.category === 'product'\" class=\"review-product\">\n          <img\n              :src=\"getProductImage(review.item_id)\"\n              alt=\"Product image\"\n              class=\"product-image\"\n          />\n          <div class=\"product-info\">\n            <p class=\"product-title\">{{ getProductTitle(review.item_id) }}</p>\n          </div>\n        </div>\n        <h3>\n          {{ review.name_of_reviewer }}\n          <span class=\"rating\">({{ review.score }} ★)</span>\n        </h3>\n        <p>{{ review.text }}</p>\n        <p class=\"category\">Категория: {{ review.category }}</p>\n        <p class=\"date\">{{ formatDate(review.date) }}</p>\n      </div>\n    </div>\n\n\n    <div class=\"feedback-form\">\n      <h3>Оставьте свой отзыв</h3>\n      <form @submit.prevent=\"submitFeedback\">\n        <div class=\"form-group\">\n          <label for=\"name\">Ваше имя:</label>\n          <input type=\"text\" id=\"name\" v-model=\"feedback.name\" required placeholder=\"Введите ваше имя\" />\n          <span v-if=\"!feedback.name\" class=\"error\">Это поле обязательно для заполнения</span>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"feedback\">Ваш отзыв:</label>\n          <textarea id=\"feedback\" v-model=\"feedback.message\" rows=\"4\" required placeholder=\"Напишите ваш отзыв\"></textarea>\n          <span v-if=\"!feedback.message\" class=\"error\">Это поле обязательно для заполнения</span>\n        </div>\n        <div class=\"form-group\">\n          <label>Оценка:</label>\n          <div class=\"stars\">\n            <span\n                v-for=\"n in 5\"\n                :key=\"n\"\n                class=\"star\"\n                :class=\"{ 'filled': n <= feedback.rating }\"\n                @click=\"setRating(n)\"\n            >★</span>\n          </div>\n          <span v-if=\"feedback.rating === 0\" class=\"error\">Пожалуйста, выберите оценку</span>\n        </div>\n\n\n        <div class=\"form-group\">\n          <label for=\"category\">Категория:</label>\n          <select id=\"category\" v-model=\"feedback.category\" required>\n            <option value=\"service\">Сервис</option>\n            <option value=\"product\">Продукт</option>\n            <option value=\"website\">Веб-сайт</option>\n          </select>\n          <span v-if=\"!feedback.category\" class=\"error\">Это поле обязательно для выбора</span>\n        </div>\n\n        <div class=\"form-group\">\n          <label>\n            <input type=\"checkbox\" v-model=\"feedback.agree\" /> Я согласен на обработку персональных данных\n          </label>\n        </div>\n\n        <div class=\"form-group\" v-if=\"feedback.category === 'product'\">\n          <label for=\"product\">Выберите продукт:</label>\n          <VueSelect\n              :items=\"products\"\n              :value=\"selectedProductId\"\n              @productId=\"updateSelectedProductId\"\n          />\n        </div>\n\n        <div class=\"form-group\">\n          <button  class=\"form__button\" :disabled=\"!isFormValid\">Отправить отзыв</button>\n        </div>\n      </form>\n    </div>\n  </div>\n  <AppFooter></AppFooter>\n</template>\n\n<script>\nimport AppHeader from \"@/components/AppHeader.vue\";\nimport AppFooter from \"@/components/AppFooter.vue\";\nimport axios from \"axios\";\nimport VueSelect from \"@/components/VueSelect.vue\";\n\nexport default {\n  name: \"ProductReviews\",\n  components: {VueSelect, AppFooter, AppHeader },\n  data() {\n    return {\n      products: [],\n      reviews: [],\n      feedback: {\n        name: '',\n        message: '',\n        rating: 0,\n        agree: false,\n        category: 'product'\n      },\n      selectedProductId: null,\n    };\n  },\n  computed: {\n    isFormValid() {\n      return (\n          this.feedback.name &&\n          this.feedback.message &&\n          this.feedback.rating > 0 &&\n          this.feedback.category &&\n          this.feedback.agree &&\n          (this.feedback.category !== \"product\" || this.selectedProductId)\n      );\n    },\n    productsWithLabels() {\n      return this.products.map(product => ({\n        label: product.title,\n        value: product.id\n      }));\n    },\n  },\n  methods: {\n    getProductImage(itemId) {\n      const product = this.products.find((product) => product.id === itemId);\n      return product && product.image_urls.length > 0 ? product.image_urls[0] : 'default-image.jpg';\n    },\n    getProductTitle(itemId) {\n      const product = this.products.find((product) => product.id === itemId);\n      return product ? product.title : 'Неизвестный продукт';\n    },\n    updateSelectedProductId(productId) {\n      console.log(\"Received productId in parent:\", productId); // Лог для проверки\n      this.selectedProductId = productId;\n    },\n    async fetchReviews() {\n      try {\n        const response = await axios.get(\"http://localhost:8000/api/reviews\");\n        this.reviews = response.data;\n      } catch (error) {\n        console.error(\"Ошибка при загрузке отзывов:\", error);\n      }\n    },\n    async fetchProducts() {\n      try {\n        const response = await axios.get(\"http://localhost:8000/api/items\");\n        this.products = response.data;\n        console.log(this.products);\n      } catch (error) {\n        console.error(\"Ошибка при загрузке отзывов:\", error);\n      }\n    },\n    async submitFeedback() {\n      try {\n        const userId = sessionStorage.getItem('userId');\n        const toNow = new Date().toISOString();\n        console.log({\n          name_of_reviewer: this.feedback.name,\n          text: this.feedback.message,\n          score: this.feedback.rating,\n          category: this.feedback.category,\n          date: toNow,\n          user_id: parseInt(userId),\n          item_id: this.selectedProductId,\n        });\n        await axios.post('http://localhost:8000/api/reviews', {\n          name_of_reviewer: this.feedback.name,\n          text: this.feedback.message,\n          score: this.feedback.rating,\n          category: this.feedback.category,\n          date: toNow,\n          user_id: parseInt(userId),\n          item_id: this.selectedProductId,\n        });\n        await this.fetchReviews();\n        this.feedback = {\n          name: '',\n          message: '',\n          rating: 0,\n          agree: false,\n          category: 'product',\n        };\n      } catch (error) {\n        console.error(\"Ошибка при загрузке данных отзыва:\", error.response ? error.response.data : error);\n        alert(\"Не удалось отправить отзыв. Попробуйте позже.\");\n      }\n    },\n    formatDate(dateString) {\n      const date = new Date(dateString);\n      return date.toLocaleDateString('ru-RU', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n      });\n    },\n    setRating(rating) {\n      this.feedback.rating = rating;\n    }\n  },\n  mounted() {\n    this.fetchReviews();\n    this.fetchProducts();\n  },\n};\n</script>\n\n<style scoped>\n\n.vue-select-dropdown {\n  position: absolute;\n  z-index: 10; /* Убедитесь, что список виден над другими элементами */\n  background: white;\n  border: 1px solid #ccc;\n  max-height: 200px; /* Ограничьте высоту, чтобы не перекрывать весь экран */\n  overflow-y: auto; /* Добавьте прокрутку */\n}\n.vue-select {\n  position: relative;\n  display: inline-block; /* Чтобы список был связан с селектом */\n  width: 100%; /* Убедитесь, что поле занимает всю доступную ширину */\n}\n\n\n.product-item img {\n  width: 80px;\n  height: 80px;\n  object-fit: cover;\n  border-radius: 4px;\n}\n\n.product-item p {\n  margin-top: 10px;\n  font-size: 0.9em;\n  color: #333;\n  text-align: center;\n}\n.review-product {\n  display: flex;\n  align-items: center; /* Центрирует текст по вертикали относительно изображения */\n  margin-bottom: 10px;\n}\n\n.product-image {\n  width: 80px;\n  height: 80px;\n  object-fit: cover;\n  border-radius: 4px;\n  margin-right: 15px; /* Отступ между изображением и текстом */\n}\n\n.product-info {\n  display: flex;\n  flex-direction: column;\n  justify-content: center; /* Центрирует текст внутри, если появятся дополнительные элементы */\n}\n\n.product-title {\n  font-weight: bold;\n  font-size: 1em;\n  color: #333;\n  text-align: left; /* Текст выравнивается по левому краю */\n}\n\n\n.product-item:hover {\n  transform: scale(1.05);\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n.product-item.selected {\n  border-color: gold;\n  box-shadow: 0 0 10px gold;\n}\n\n\n.reviews-page {\n  width: 100%;\n  max-width: 900px;\n  margin: 0 auto;\n  padding: 20px;\n}\n\n.reviews-list {\n  margin-bottom: 30px;\n}\n\n.review-item {\n  border-bottom: 1px solid #ddd;\n  padding: 15px 0;\n}\n\n.review-item h3 {\n  margin: 0;\n  font-size: 1.2em;\n}\n\n.rating {\n  color: gold;\n  margin-left: 20px;\n}\n\n\n.category {\n  font-size: 0.9em;\n  color: #666;\n}\n\n.date {\n  font-size: 0.8em;\n  color: #aaa;\n}\n\n.feedback-form {\n  background-color: #fff;\n  padding: 20px;\n  border-radius: 8px;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n.feedback-form h3 {\n  font-size: 1.5em;\n  margin-bottom: 20px;\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\ninput[type=\"checkbox\"] {\n  margin-right: 8px;\n}\n\n\n.form-group label {\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n}\n\n.form-group input[type=\"checkbox\"] {\n  margin-right: 10px; /* Отступ между чекбоксом и текстом */\n}\n\n\ninput[type=\"text\"],\ntextarea,\nselect {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n\n\n.error {\n  color: rgba(255, 0, 0, 0.6); /* Бледный полупрозрачный красный */\n  font-size: 0.85em;\n}\n\n.stars {\n  display: inline-block;\n}\n\n.star {\n  font-size: 1.5em;\n  color: #ddd;\n  cursor: pointer;\n}\n\n.star.filled {\n  color: gold;\n}\n\n.star:hover,\n.star.filled:hover {\n  color: gold;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}